{% extends "base.html" %}
{% block title %}Upload - FitTrack{% endblock %}

{% block content %}
<div class="record">
  <h1>Record Your Data</h1>
  <p>Keep track of your health data to generate meaningful insights.</p>

  <form class="record__form" id="recordForm" method="POST" action="{{ url_for('upload_bp.add_record') }}">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

    <div class="record__group">
      <label for="date">Date</label>
      <input type="date" id="date" name="date" required value="{{ form_data.get('date', '') }}">
    </div>

    <div class="record__group">
      <label for="weight">Today's Weight (kg)</label>
      <input type="number" id="weight" name="weight" step="0.01" required value="{{ form_data.get('weight', '') }}">
    </div>

    <div class="record__group">
      <label class="tooltip-container">
        Meals
        <i class="fa-solid fa-circle-info tooltip-icon"></i>
        <span class="custom-tooltip">
          If you skipped a meal,<br> type "NO". <br><br>
          Leaving it blank will auto-fill a default value.
        </span>
      </label>
      <input type="text" name="breakfast" placeholder="Breakfast" value="{{ form_data.get('breakfast', '') }}" />
      <input type="text" name="lunch" placeholder="Lunch" value="{{ form_data.get('lunch', '') }}" />
      <input type="text" name="dinner" placeholder="Dinner" value="{{ form_data.get('dinner', '') }}" />
    </div>

    <div class="record__group">
      <label class="tooltip-container">
        Exercise Activities
        <i class="fa-solid fa-circle-info tooltip-icon"></i>
        <span class="custom-tooltip">
          • Light: slow pace, frequent rests<br>
          • Moderate: steady effort, some breaks<br>
          • Intense: high pace, sustained effort, minimal rest
        </span>
      </label>

      <div id="exerciseContainer">
        <div class="exercise__entry">
          <input type="text" name="exercise[]" placeholder="e.g. running" />
          <input type="number" name="duration[]" placeholder="Duration (min)" min="1" />
          <select name="intensity[]">
            <option value="">Intensity</option>
            <option value="light">Light</option>
            <option value="moderate">Moderate</option>
            <option value="intense">Intense</option>
          </select>
          <button type="button" class="remove-entry-btn" onclick="removeThisRow(this)">−</button>
        </div>
      </div>
      <button type="button" class="add-exercise-btn" onclick="addExerciseRow()">+ Add</button>
    </div>

    <div class="record__button-row">
      <button type="submit" class="record__btn">Submit Record</button>
      <button type="button" id="view-history" class="record__btn">View History</button>
    </div>
  </form>
  {% if form_data.total_calories or form_data.calories_burned %}
    <div class="estimated-calories" style="margin-top: 1rem; padding: 1rem; background: #f8f8f8; border-left: 4px solid #4CAF50;">
      <h4>Estimated Meal Calories (intake):</h4>
      <p><strong>{{ form_data.total_calories or 'N/A' }} kcal</strong></p>

      <h4>Estimated Exercise Calories Burned:</h4>
      <p><strong>{{ form_data.calories_burned or 'N/A' }} kcal</strong></p>

      {% if form_data.total_calories and form_data.calories_burned %}
        <h4>Net Calories (intake - burned):</h4>
        <p><strong>{{ form_data.total_calories - form_data.calories_burned }} kcal</strong></p>
      {% endif %}
    </div>
  {% endif %}

</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/upload.js') }}"></script>
{% endblock %}
